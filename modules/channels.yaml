_ulid: 01KG1RC8K79XY382WY05JJ3JVR
slugs:
  - channels
title: Channels
type: module
status:
  maturity: draft
  implementation: not_started
description: "Platform adapter system: registration, lifecycle, DM policies, and media handling"
tags: []
depends_on: []
implements: []
relates_to: []
tests: []
traits: []
notes: []
features:
  - _ulid: 01KG1RD3V5MPXRQ62Q9CQ3AMQR
    slugs:
      - channel-registry
    title: Channel Registry
    type: feature
    tags: []
    description: Plugin registration system for platform adapters with discovery and configuration
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    traits:
      - "@trait-validated"
    notes: []
    created: 2026-01-28T07:34:36.134Z
    acceptance_criteria:
      - id: ac-1
        given: new channel adapter module available
        when: registration requested
        then: validates adapter interface and adds to registry
      - id: ac-2
        given: message arrives for specific platform
        when: adapter lookup performed
        then: returns correct adapter for the platform
      - id: ac-3
        given: adapter with invalid interface
        when: registration attempted
        then: returns validation error listing missing methods
    status:
      maturity: draft
      implementation: in_progress
  - _ulid: 01KG1RD682MGVX9083BXA1J9M8
    slugs:
      - channel-lifecycle
    title: Channel Lifecycle
    type: feature
    tags: []
    description: Connection management with health checks for platform adapters
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    traits:
      - "@trait-rate-limited"
      - "@trait-recoverable"
      - "@trait-observable"
      - "@trait-health-monitored"
      - "@trait-graceful-shutdown"
    notes: []
    created: 2026-01-28T07:34:38.595Z
    acceptance_criteria:
      - id: ac-1
        given: channel adapter starts
        when: initialization completes
        then: establishes connection and begins health monitoring
      - id: ac-2
        given: health check fails for channel
        when: consecutive failures exceed threshold
        then: marks channel unhealthy and triggers reconnection
      - id: ac-3
        given: shutdown signal received
        when: graceful shutdown initiated
        then: drains pending messages and closes connections cleanly
      - id: ac-4
        given: rate limit exceeded
        when: sending message
        then: queues and retries with backoff
    status:
      maturity: draft
      implementation: implemented
  - _ulid: 01KG1RD8WH7K88Y89V0CQ473ZH
    slugs:
      - channel-dm-policy
    title: DM Policy
    type: feature
    tags: []
    description: DM request workflows supporting pairing-required and open access policies
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    traits:
      - "@trait-idempotent"
      - "@trait-validated"
    notes: []
    created: 2026-01-28T07:34:41.298Z
    acceptance_criteria:
      - id: ac-1
        given: channel configured with pairing_required policy
        when: new user sends message
        then: creates pending request awaiting admin approval
      - id: ac-2
        given: pending DM request exists
        when: admin approves request
        then: session created and user notified
      - id: ac-3
        given: channel configured with open policy
        when: any user sends message
        then: session created immediately without approval
      - id: ac-4
        given: admin denies pending DM request
        when: denial processed
        then: request removed and user notified of rejection
      - id: ac-5
        given: same approval request submitted twice
        when: processed
        then: only one session created
    status:
      maturity: draft
      implementation: implemented
  - _ulid: 01KG1RDB0J11H95T8TACVNS0A4
    slugs:
      - channel-media
    title: Media Handling
    type: feature
    tags: []
    description: Media attachment handling for images, files, and other content types
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    traits: []
    notes: []
    created: 2026-01-28T07:34:43.474Z
    acceptance_criteria:
      - id: ac-1
        given: message contains image attachment
        when: media handler processes message
        then: extracts and stores image with metadata
      - id: ac-2
        given: agent response includes file
        when: media prepared for delivery
        then: uploads file and includes reference in outbound message
      - id: ac-3
        given: attachment exceeds size limit
        when: media handler validates
        then: rejects with size limit error
    status:
      maturity: draft
      implementation: implemented
  - _ulid: 01KG4K3JT7X9P3Q81XNTQRZSHE
    slugs:
      - discord-channel-adapter
    title: Discord Channel Adapter
    type: feature
    tags: []
    description: Discord.js-based implementation of ChannelAdapter interface. Handles message
      normalization, sending, and Discord-specific features like threads and embeds.
    depends_on:
      - "@channel-registry"
    implements: []
    relates_to: []
    tests: []
    traits:
      - "@trait-rate-limited"
      - "@trait-recoverable"
      - "@trait-observable"
    notes: []
    created: 2026-01-29T09:59:44.199Z
    acceptance_criteria:
      - id: ac-1
        given: Discord message received
        when: parseIncoming called
        then: returns NormalizedMessage with platform='discord', channelId, authorId, content
      - id: ac-2
        given: NormalizedMessage to send
        when: sendMessage called
        then: sends to Discord channel, respects rate limits, returns message ID
      - id: ac-3
        given: message content exceeds Discord limit (2000 chars)
        when: sendMessage called
        then: splits into multiple messages or uses embed
      - id: ac-4
        given: Discord connection lost
        when: reconnect triggered
        then: attempts reconnection with exponential backoff
      - id: ac-5
        given: Streaming message content exceeds Discord limit (2000 chars)
        when: editMessage called
        then: Splits at semantic boundaries (before code blocks when possible) AND sends overflow as
          follow-up message(s) AND returns all message IDs
      - id: ac-6
        given: Streaming response contains code blocks
        when: Content approaches limit mid-code-block
        then: Buffers until code block completes (if fits) OR preemptively splits BEFORE the code block OR
          closes and reopens code block when unavoidable
      - id: ac-7
        given: Streaming response with multiple content blocks (interleaved with tool calls)
        when: Empty string chunk received (Claude streaming API convention)
        then: Finalizes current block AND starts new block on next non-empty chunk AND joins blocks with
          visual separation (double newline)
    status:
      maturity: draft
      implementation: in_progress
    requirements:
      - _ulid: 01KG93A3GEVCRNZQ8HY1A2VQGX
        slugs:
          - discord-tool-widgets
        title: Rich Tool Call Display
        type: requirement
        tags:
          - discord
          - ui
        description: Display agent tool calls and results as rich Discord embeds with interactive
          components. Shows what the agent is doing in a compact, readable format with expand
          buttons for full details. Uses ACP tool_call/tool_call_update events to track and present
          tool execution.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        traits: []
        notes: []
        created: 2026-01-31T03:59:52.847Z
        acceptance_criteria:
          - id: ac-1
            given: Agent executes a tool call (bash, read, write, etc.)
            when: tool_call event received from ACP
            then: Discord message shows compact widget with tool type icon, key parameters, and status
          - id: ac-2
            given: Bash command completes
            when: tool_call_update received with result
            then: Widget shows exit code, duration, and first 10 lines of output with expand button for full
              output
          - id: ac-3
            given: File edit/write tool completes
            when: tool_call_update received with diff
            then: Widget shows syntax-highlighted diff with +/- prefixes, line ranges, and expand button for
              full content
          - id: ac-4
            given: User clicks expand button on a widget
            when: Discord component interaction received
            then: Bot sends follow-up message with full tool output (auto-deleted after 60 seconds), handles
              Discord rate limits
          - id: ac-5
            given: Multiple tool calls executing rapidly
            when: tool_call_update events stream in
            then: ToolCallTracker batches message updates, MessageUpdateBatcher respects Discord rate limits (5
              edits per 5 seconds per message)
          - id: ac-6
            given: Tool call fails with error (bash exit code != 0, file read permission denied, etc.)
            when: tool_call_update received with error status
            then: Widget shows red embed border, ‚ùå icon, error message summary (first 100 chars), expand button
              for full error details
          - id: ac-7
            given: More than 10 concurrent tool calls executing
            when: rendering widgets in Discord message
            then: Splits across multiple messages with max 10 embeds per message, maintains chronological order
          - id: ac-8
            given: File edit/write operates on binary file (PNG, PDF, etc.)
            when: tool_call_update received with diff
            then: Widget shows '(binary file changed, X bytes)' instead of diff content
          - id: ac-9
            given: Session ends (completed, cancelled, or crash) with pending tool calls
            when: session cleanup triggered
            then: All pending widgets updated to final state (completed/cancelled/timed out), ToolCallTracker
              clears tracking data
        status:
          maturity: draft
          implementation: in_progress
