- _ulid: 01KG1QW1WPDYZZ7Q7SQQCCYMDF
  slugs: []
  title: Spec out core kynetic-bot functionality
  type: task
  spec_ref: null
  meta_ref: null
  status: in_progress
  blocked_by: []
  depends_on: []
  context: []
  priority: 1
  tags: []
  vcs_refs: []
  created_at: 2026-01-28T07:25:17.077Z
  started_at: 2026-01-28T07:25:32.707Z
  notes:
    - _ulid: 01KG1QWB61BTD9E260GBGMJ7FF
      created_at: 2026-01-28T07:25:26.593Z
      author: "@claude"
      content: |-
        ## Scope

        Create initial specification for kynetic-bot core functionality:
        - Cross-platform chat bot with web UI and mobile clients (UI deferred)
        - Leverages kspec for task management and memory/storage
        - Uses/extends ACP for agent execution (like kspec ralph mode)
        - Skills integration

        ## Reference Sources
        - moltbot (GitHub): UX/chat patterns and solved problems
        - ../kynetic: Robust ACP implementation, chat UI, skills
        - ../kynetic-spec: Task/memory foundation

        ## Focus
        Core functionality only - minimum for something functional. No UI specs yet.

        ## Approach
        1. Research all three reference sources
        2. Identify patterns, gaps, and opportunities
        3. Synthesize into spec items with acceptance criteria
        4. Cover explicit and implicit user expectations
      supersedes: null
    - _ulid: 01KG1R0PR4HWKQPTT94XKD8Z89
      created_at: 2026-01-28T07:27:49.508Z
      author: "@claude"
      content: |-
        ## Research Complete

        ### Moltbot Key Patterns
        - **Architecture**: Local-first Gateway control plane with WebSocket hub
        - **Platforms**: 13+ channels (WhatsApp, Telegram, Slack, Discord, Signal, iMessage, etc.)
        - **Session Keys**: Encodes agent:agentId:sessionType:peerInfo for routing
        - **Agent**: Pi runtime with tool streaming, subagent registry
        - **Memory**: Vector search (SQLite + embeddings), session compaction
        - **Skills**: Bundled, managed, workspace-level - skill.yaml + handlers
        - **Protocol**: JSON-RPC frames (req/res/event) over WebSocket

        ### Kynetic Key Patterns
        - **Architecture**: Hub (orchestrator) ↔ Lifeline (bridge) ↔ Agent (ephemeral)
        - **ACP**: JSON-RPC 2.0 framing, stdio communication, timeout management
        - **Sessions**: Semantic units, compaction triggers, crash recovery with lineage
        - **Skills**: MCP server integration, skill:// URI protocol
        - **Protocol**: Message envelopes with seq/ack, gap detection, idempotency
        - **State**: Task states (pending→ready→assigned→in_progress→completed)

        ### Kspec Key Patterns
        - **Shadow Branch**: Spec/task state separate from code, auto-commit
        - **Tasks**: Append-only notes, automation eligibility, failure tracking
        - **Specs**: module > feature > requirement hierarchy, Given/When/Then AC
        - **Traits**: Reusable AC bundles for cross-cutting concerns
        - **Ralph Mode**: Autonomous loop with circuit breaker, escalation on failures
        - **Meta-spec**: Agents, workflows, conventions, observations

        ### Spec Writing Guidelines
        - Use CLI commands, not manual YAML
        - AC format: given/when/then, concrete examples
        - 3-5 AC per item, independently testable
        - Traits for 3+ specs needing same behavior
        - Derive tasks from specs, add implementation notes
      supersedes: null
    - _ulid: 01KG1R48NSWMQHVF864SK5SH03
      created_at: 2026-01-28T07:29:46.169Z
      author: "@claude"
      content: |-
        ## Spec Structure Finalized

        ### Gap Analysis Summary
        - **Reusable from Kynetic (70%)**: ACP, session management, MCP tools, hub protocol
        - **Extend (15%)**: Session routing keys, kspec MCP tools, agent lifecycle
        - **Net-new (15%)**: Channel abstraction, DM policies, kspec memory integration

        ### Core Modules
        1. **messaging** - Conversation core (routing, transform, streaming, history)
        2. **channels** - Platform integration (registry, lifecycle, DM policy, media)
        3. **memory** - Context & persistence (kspec sync, conversation notes, context window)
        4. **agent** - Execution model (lifecycle, autonomous, skills, escalation)

        ### MVP Priority (Phase 1)
        1. msg-routing - Session key routing
        2. channel-registry - Plugin architecture
        3. mem-kspec-sync - Persistence foundation
        4. agent-lifecycle - Basic agent management

        ### Cross-Cutting Traits
        - @trait-idempotent - Message handler safety
        - @trait-observable - Event emission
        - @trait-recoverable - Crash recovery
        - @trait-rate-limited - Platform rate limits

        Next: Create kspec items with AC
      supersedes: null
  todos: []
