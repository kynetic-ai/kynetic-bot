- _ulid: 01KG1QW1WPDYZZ7Q7SQQCCYMDF
  slugs: []
  title: Spec out core kynetic-bot functionality
  type: task
  spec_ref: null
  meta_ref: null
  status: pending_review
  blocked_by: []
  depends_on: []
  context: []
  priority: 1
  tags: []
  vcs_refs: []
  created_at: 2026-01-28T07:25:17.077Z
  started_at: 2026-01-28T07:25:32.707Z
  notes:
    - _ulid: 01KG1QWB61BTD9E260GBGMJ7FF
      created_at: 2026-01-28T07:25:26.593Z
      author: "@claude"
      content: |-
        ## Scope

        Create initial specification for kynetic-bot core functionality:
        - Cross-platform chat bot with web UI and mobile clients (UI deferred)
        - Leverages kspec for task management and memory/storage
        - Uses/extends ACP for agent execution (like kspec ralph mode)
        - Skills integration

        ## Reference Sources
        - moltbot (GitHub): UX/chat patterns and solved problems
        - ../kynetic: Robust ACP implementation, chat UI, skills
        - ../kynetic-spec: Task/memory foundation

        ## Focus
        Core functionality only - minimum for something functional. No UI specs yet.

        ## Approach
        1. Research all three reference sources
        2. Identify patterns, gaps, and opportunities
        3. Synthesize into spec items with acceptance criteria
        4. Cover explicit and implicit user expectations
      supersedes: null
    - _ulid: 01KG1R0PR4HWKQPTT94XKD8Z89
      created_at: 2026-01-28T07:27:49.508Z
      author: "@claude"
      content: |-
        ## Research Complete

        ### Moltbot Key Patterns
        - **Architecture**: Local-first Gateway control plane with WebSocket hub
        - **Platforms**: 13+ channels (WhatsApp, Telegram, Slack, Discord, Signal, iMessage, etc.)
        - **Session Keys**: Encodes agent:agentId:sessionType:peerInfo for routing
        - **Agent**: Pi runtime with tool streaming, subagent registry
        - **Memory**: Vector search (SQLite + embeddings), session compaction
        - **Skills**: Bundled, managed, workspace-level - skill.yaml + handlers
        - **Protocol**: JSON-RPC frames (req/res/event) over WebSocket

        ### Kynetic Key Patterns
        - **Architecture**: Hub (orchestrator) ↔ Lifeline (bridge) ↔ Agent (ephemeral)
        - **ACP**: JSON-RPC 2.0 framing, stdio communication, timeout management
        - **Sessions**: Semantic units, compaction triggers, crash recovery with lineage
        - **Skills**: MCP server integration, skill:// URI protocol
        - **Protocol**: Message envelopes with seq/ack, gap detection, idempotency
        - **State**: Task states (pending→ready→assigned→in_progress→completed)

        ### Kspec Key Patterns
        - **Shadow Branch**: Spec/task state separate from code, auto-commit
        - **Tasks**: Append-only notes, automation eligibility, failure tracking
        - **Specs**: module > feature > requirement hierarchy, Given/When/Then AC
        - **Traits**: Reusable AC bundles for cross-cutting concerns
        - **Ralph Mode**: Autonomous loop with circuit breaker, escalation on failures
        - **Meta-spec**: Agents, workflows, conventions, observations

        ### Spec Writing Guidelines
        - Use CLI commands, not manual YAML
        - AC format: given/when/then, concrete examples
        - 3-5 AC per item, independently testable
        - Traits for 3+ specs needing same behavior
        - Derive tasks from specs, add implementation notes
      supersedes: null
    - _ulid: 01KG1R48NSWMQHVF864SK5SH03
      created_at: 2026-01-28T07:29:46.169Z
      author: "@claude"
      content: |-
        ## Spec Structure Finalized

        ### Gap Analysis Summary
        - **Reusable from Kynetic (70%)**: ACP, session management, MCP tools, hub protocol
        - **Extend (15%)**: Session routing keys, kspec MCP tools, agent lifecycle
        - **Net-new (15%)**: Channel abstraction, DM policies, kspec memory integration

        ### Core Modules
        1. **messaging** - Conversation core (routing, transform, streaming, history)
        2. **channels** - Platform integration (registry, lifecycle, DM policy, media)
        3. **memory** - Context & persistence (kspec sync, conversation notes, context window)
        4. **agent** - Execution model (lifecycle, autonomous, skills, escalation)

        ### MVP Priority (Phase 1)
        1. msg-routing - Session key routing
        2. channel-registry - Plugin architecture
        3. mem-kspec-sync - Persistence foundation
        4. agent-lifecycle - Basic agent management

        ### Cross-Cutting Traits
        - @trait-idempotent - Message handler safety
        - @trait-observable - Event emission
        - @trait-recoverable - Crash recovery
        - @trait-rate-limited - Platform rate limits

        Next: Create kspec items with AC
      supersedes: null
    - _ulid: 01KG1RMXW0NCDJ06VXJBWA4QWA
      created_at: 2026-01-28T07:38:52.160Z
      author: "@claude"
      content: |-
        ## Spec Structure Created

        Created 4 modules with 15 features and 46 acceptance criteria:

        ### Modules
        - **@messaging** - Core message handling
        - **@channels** - Platform adapter system  
        - **@memory** - Persistent state management
        - **@agent** - Agent orchestration

        ### Features per Module

        **Messaging (4 features, 12 AC)**
        - @msg-routing - Session key-based routing (3 AC)
        - @msg-transform - Platform-agnostic normalization (3 AC)
        - @msg-streaming - Chunked response delivery (3 AC)
        - @msg-history - Semantic boundaries for context (3 AC)

        **Channels (4 features, 13 AC)**
        - @channel-registry - Plugin registration (3 AC)
        - @channel-lifecycle - Connection health checks (3 AC)
        - @channel-dm-policy - Pairing/open workflows (4 AC)
        - @channel-media - Media attachments (3 AC)

        **Memory (3 features, 9 AC)**
        - @mem-kspec-sync - Shadow branch integration (3 AC)
        - @mem-conversation - Conversation as notes (3 AC)
        - @mem-context-window - Compaction management (3 AC)

        **Agent (4 features, 12 AC)**
        - @agent-lifecycle - Spawn, monitor, restart (3 AC)
        - @agent-autonomous - Ralph-mode with circuit breaker (3 AC)
        - @agent-skills - Skill discovery and tools (3 AC)
        - @agent-escalation - Human handoff (3 AC)

        All items validated with kspec validate.
      supersedes: null
    - _ulid: 01KG1RNXD3J6MW7QM5DBRN8MVT
      created_at: 2026-01-28T07:39:24.451Z
      author: "@claude"
      content: |-
        ## Spec Creation Complete

        ### Created Structure
        - 4 modules: messaging, channels, memory, agent
        - 15 features with 46 acceptance criteria total
        - All in Given/When/Then format

        ### Files Created
        - .kspec/modules/messaging.yaml (4 features, 12 AC)
        - .kspec/modules/channels.yaml (4 features, 13 AC)
        - .kspec/modules/memory.yaml (3 features, 9 AC)
        - .kspec/modules/agent.yaml (4 features, 12 AC)

        ### Next Steps
        1. Review and refine AC based on implementation learnings
        2. Add cross-cutting traits (@trait-idempotent, @trait-recoverable, etc.)
        3. Derive tasks from specs when ready to implement
        4. Start with Phase 1 MVP: msg-routing, channel-registry, mem-kspec-sync, agent-lifecycle

        ### Session Continuity
        Research documented in previous notes. Spec structure follows:
        - Reuse kynetic ACP/session/MCP (70%)
        - Extend session routing, kspec MCP tools (15%)
        - Build channel abstraction, DM policies, kspec memory (15%)
      supersedes: null
    - _ulid: 01KG1S3XWC4PTKKET8JBJXGSSD
      created_at: 2026-01-28T07:47:03.692Z
      author: "@claude"
      content: |-
        ## Phase 2: Implementation Planning

        ### Objective
        Use plan mode to flesh out realistic implementation path, then:
        1. Derive tasks from specs
        2. Break down into granular, Ralph-automatable units
        3. Flesh out with implementation details and solid AC
        4. Handle unknowns as prerequisite tasks or user questions

        ### Success Criteria
        - Tasks are standalone (no session context needed)
        - Tasks have clear AC (no interpretation required)
        - Dependencies are explicit
        - Unknowns resolved before bulk work begins
      supersedes: null
  todos: []
